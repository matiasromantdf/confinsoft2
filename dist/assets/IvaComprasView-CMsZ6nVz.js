import{aa as T,ab as p,ac as v,ad as e,an as D,af as N,aK as V,aL as w,ag as L,h as t,ak as f,al as _,ae as x,am as y,ai as l,v as b,aj as I,ao as h,aq as F,z as k,aI as A,l as d,az as i,at as S,aN as C,aO as m,aP as c,ar as E}from"./index-B4ylqVfw.js";const H={data(){return{url:"https://api-tpv.confinsoft.com/public",fechaDesde:"",fechaHasta:"",datos:null,loading:!1,headers:[{title:"Fecha",key:"fecha",value:"fecha"},{title:"Tipo",key:"tipo_comprobante_texto",value:"tipo_comprobante_texto"},{title:"Número",key:"numero_completo",value:"numero_completo"},{title:"Proveedor",key:"proveedor_nombre",value:"proveedor_nombre"},{title:"CUIT",key:"cuit_proveedor",value:"cuit_proveedor"},{title:"Neto 21%",key:"neto_gravado_21",value:"neto_gravado_21"},{title:"IVA 21%",key:"iva_21",value:"iva_21"},{title:"Neto 10.5%",key:"neto_gravado_10_5",value:"neto_gravado_10_5"},{title:"IVA 10.5%",key:"iva_10_5",value:"iva_10_5"},{title:"Total",key:"total",value:"total"}]}},methods:{consultarLibroIva(){if(!this.fechaDesde||!this.fechaHasta){this.$swal({title:"Error",text:"Debe seleccionar un rango de fechas",icon:"error"});return}this.loading=!0,L.get(`${this.url}/${this.usuario.tpv}/compras/libroIvaCompras`,{headers:{Authorization:this.usuario.token},params:{fecha_desde:this.fechaDesde,fecha_hasta:this.fechaHasta}}).then(r=>{this.datos=r.data}).catch(r=>{console.error(r),this.$swal({title:"Error",text:"No se pudo consultar el libro IVA de compras",icon:"error"})}).finally(()=>{this.loading=!1})},formatear(r){return r?"$ "+parseFloat(r).toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}):"$ 0,00"},formatearFecha(r){return r?new Date(r).toLocaleDateString("es-AR"):""},exportarExcel(){if(!this.datos||!this.datos.comprobantes)return;const r=this.datos.comprobantes.map(u=>({Fecha:this.formatearFecha(u.fecha),Tipo:u.tipo_comprobante_texto,Número:u.numero_completo,Proveedor:u.proveedor_nombre,CUIT:u.cuit_proveedor,"Neto 21%":parseFloat(u.neto_gravado_21||0),"IVA 21%":parseFloat(u.iva_21||0),"Neto 10.5%":parseFloat(u.neto_gravado_10_5||0),"IVA 10.5%":parseFloat(u.iva_10_5||0),Total:parseFloat(u.total||0)}));r.push({Fecha:"",Tipo:"",Número:"",Proveedor:"TOTALES",CUIT:"","Neto 21%":parseFloat(this.datos.totales.total_neto_21||0),"IVA 21%":parseFloat(this.datos.totales.total_iva_21||0),"Neto 10.5%":parseFloat(this.datos.totales.total_neto_10_5||0),"IVA 10.5%":parseFloat(this.datos.totales.total_iva_10_5||0),Total:parseFloat(this.datos.totales.total_general||0)});const a=V.json_to_sheet(r),g=V.book_new();V.book_append_sheet(g,a,"Libro IVA Compras"),w(g,`Libro_IVA_Compras_${this.fechaDesde}_${this.fechaHasta}.xlsx`)}},mounted(){this.usuario.rol!=1&&this.$router.push("/no-autorizado");const r=new Date,a=new Date(r.getFullYear(),r.getMonth(),1);this.fechaDesde=a.toISOString().substr(0,10),this.fechaHasta=r.toISOString().substr(0,10)},setup(){return{usuario:N()}}},U={class:"d-flex justify-space-between flex-wrap"},O={class:"text-h6 text-center"};function P(r,a,g,u,o,n){return v(),p(D,{fluid:""},{default:e(()=>[t(f,null,{default:e(()=>[t(_,{cols:"12"},{default:e(()=>[t(x,null,{default:e(()=>[t(y,{class:"d-flex align-center"},{default:e(()=>[t(b,{class:"mr-2"},{default:e(()=>[...a[2]||(a[2]=[l("mdi-file-document-outline",-1)])]),_:1}),a[3]||(a[3]=l(" Libro IVA Compras ",-1))]),_:1}),t(I,null,{default:e(()=>[t(f,null,{default:e(()=>[t(_,{cols:"12",md:"4"},{default:e(()=>[t(F,{modelValue:o.fechaDesde,"onUpdate:modelValue":a[0]||(a[0]=s=>o.fechaDesde=s),label:"Fecha desde",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",md:"4"},{default:e(()=>[t(F,{modelValue:o.fechaHasta,"onUpdate:modelValue":a[1]||(a[1]=s=>o.fechaHasta=s),label:"Fecha hasta",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",md:"4",class:"d-flex align-center"},{default:e(()=>[t(k,{color:"primary",onClick:n.consultarLibroIva,loading:o.loading,class:"mr-2"},{default:e(()=>[t(b,{left:""},{default:e(()=>[...a[4]||(a[4]=[l("mdi-magnify",-1)])]),_:1}),a[5]||(a[5]=l(" Consultar ",-1))]),_:1},8,["onClick","loading"]),t(k,{color:"success",onClick:n.exportarExcel,disabled:!o.datos||o.loading,variant:"outlined"},{default:e(()=>[t(b,{left:""},{default:e(()=>[...a[6]||(a[6]=[l("mdi-microsoft-excel",-1)])]),_:1}),a[7]||(a[7]=l(" Exportar ",-1))]),_:1},8,["onClick","disabled"])]),_:1})]),_:1}),o.datos&&o.datos.totales?(v(),p(f,{key:0,class:"mt-4"},{default:e(()=>[t(_,{cols:"12"},{default:e(()=>[t(A,{type:"info",variant:"tonal"},{default:e(()=>[d("div",U,[d("div",null,[a[8]||(a[8]=d("strong",null,"Período:",-1)),l(" "+i(n.formatearFecha(o.datos.periodo.desde))+" al "+i(n.formatearFecha(o.datos.periodo.hasta)),1)]),d("div",null,[a[9]||(a[9]=d("strong",null,"Comprobantes:",-1)),l(" "+i(o.datos.cantidad_comprobantes),1)]),d("div",null,[a[10]||(a[10]=d("strong",null,"Total General:",-1)),l(" "+i(n.formatear(o.datos.totales.total_general)),1)])])]),_:1})]),_:1})]),_:1})):h("",!0),o.datos&&o.datos.comprobantes?(v(),p(f,{key:1},{default:e(()=>[t(_,{cols:"12"},{default:e(()=>[t(S,{headers:o.headers,items:o.datos.comprobantes,loading:o.loading,class:"elevation-1","items-per-page":"50","items-per-page-options":[10,25,50,100],"items-per-page-text":"Filas por página"},{"item.fecha":e(({item:s})=>[l(i(n.formatearFecha(s.fecha)),1)]),"item.numero_completo":e(({item:s})=>[l(i(s.numero_completo),1)]),"item.neto_gravado_21":e(({item:s})=>[l(i(n.formatear(s.neto_gravado_21)),1)]),"item.iva_21":e(({item:s})=>[l(i(n.formatear(s.iva_21)),1)]),"item.neto_gravado_10_5":e(({item:s})=>[l(i(n.formatear(s.neto_gravado_10_5)),1)]),"item.iva_10_5":e(({item:s})=>[l(i(n.formatear(s.iva_10_5)),1)]),"item.total":e(({item:s})=>[d("strong",null,i(n.formatear(s.total)),1)]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})):h("",!0),o.datos&&o.datos.totales?(v(),p(f,{key:2,class:"mt-4"},{default:e(()=>[t(_,{cols:"12"},{default:e(()=>[t(x,{color:"blue-grey-lighten-5"},{default:e(()=>[t(y,null,{default:e(()=>[...a[11]||(a[11]=[l("Totales por Alícuota",-1)])]),_:1}),t(I,null,{default:e(()=>[t(f,{dense:""},{default:e(()=>[t(_,{cols:"12",md:"6"},{default:e(()=>[t(C,{density:"compact"},{default:e(()=>[t(m,null,{default:e(()=>[t(c,null,{default:e(()=>[...a[12]||(a[12]=[d("strong",null,"IVA 21%",-1)])]),_:1})]),_:1}),t(m,null,{default:e(()=>[t(c,null,{default:e(()=>[l("Neto: "+i(n.formatear(o.datos.totales.total_neto_21)),1)]),_:1})]),_:1}),t(m,null,{default:e(()=>[t(c,null,{default:e(()=>[l("IVA: "+i(n.formatear(o.datos.totales.total_iva_21)),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(_,{cols:"12",md:"6"},{default:e(()=>[t(C,{density:"compact"},{default:e(()=>[t(m,null,{default:e(()=>[t(c,null,{default:e(()=>[...a[13]||(a[13]=[d("strong",null,"IVA 10.5%",-1)])]),_:1})]),_:1}),t(m,null,{default:e(()=>[t(c,null,{default:e(()=>[l("Neto: "+i(n.formatear(o.datos.totales.total_neto_10_5)),1)]),_:1})]),_:1}),t(m,null,{default:e(()=>[t(c,null,{default:e(()=>[l("IVA: "+i(n.formatear(o.datos.totales.total_iva_10_5)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(E,{class:"my-3"}),d("div",O,[d("strong",null,"TOTAL GENERAL: "+i(n.formatear(o.datos.totales.total_general)),1)])]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),!o.datos&&!o.loading?(v(),p(f,{key:3},{default:e(()=>[t(_,{cols:"12"},{default:e(()=>[t(A,{type:"warning",variant:"tonal"},{default:e(()=>[...a[14]||(a[14]=[l(' Seleccione un rango de fechas y haga clic en "Consultar" para ver el libro IVA de compras. ',-1)])]),_:1})]),_:1})]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const B=T(H,[["render",P]]);export{B as default};
