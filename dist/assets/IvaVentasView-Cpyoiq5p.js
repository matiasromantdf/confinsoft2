import{aa as T,ab as h,ac as c,ad as t,an as w,af as k,ag as E,h as e,ak as m,al as u,ae as x,am as A,ai as o,v as p,aj as y,ar as g,ap as N,z as C,aI as D,l as i,az as r,at as F,aL as b,aM as _,aN as f,aq as G}from"./index-Dse_sjTz.js";import{u as I,a as S}from"./xlsx-Ca__rWmv.js";let L=new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:2});const H={data(){return{fechaDesde:"",fechaHasta:"",datos:null,loading:!1,url:"https://api-tpv.confinsoft.com/public",headers:[{title:"Fecha",value:"fecha",sortable:!0},{title:"Tipo",value:"tipo_comprobante_texto",sortable:!0},{title:"N° Comprobante",value:"numero_completo",sortable:!1},{title:"Cliente",value:"cliente_nombre",sortable:!0},{title:"DNI/CUIT",value:"cliente_dni",sortable:!1},{title:"Neto 21%",value:"neto_gravado_21",sortable:!0},{title:"IVA 21%",value:"iva_21",sortable:!0},{title:"Neto 10.5%",value:"neto_gravado_10_5",sortable:!0},{title:"IVA 10.5%",value:"iva_10_5",sortable:!0},{title:"Total",value:"total",sortable:!0}]}},methods:{consultarLibroIva(){if(!this.fechaDesde||!this.fechaHasta){this.$swal("Error","Debes seleccionar un rango de fechas","error");return}const n=Math.floor((new Date(this.fechaHasta)-new Date(this.fechaDesde))/(1e3*60*60*24));if(n>90){this.$swal("Error","El período no puede superar 3 meses (90 días)","error");return}if(n<0){this.$swal("Error",'La fecha "hasta" debe ser posterior a la fecha "desde"',"error");return}this.loading=!0,E.get(`${this.url}/${this.usuario.tpv}/facturas/libroIvaVentas?fecha_desde=${this.fechaDesde}&fecha_hasta=${this.fechaHasta}`,{headers:{Authorization:this.usuario.token}}).then(l=>{this.datos=l.data}).catch(l=>{console.error(l),this.$swal("Error","Error al consultar el libro IVA","error")}).finally(()=>{this.loading=!1})},exportarExcel(){if(!this.datos||!this.datos.comprobantes)return;const n=this.datos.comprobantes.map(a=>({Fecha:this.formatearFecha(a.fecha),"Tipo Comprobante":a.tipo_comprobante_texto,"N° Comprobante":a.numero_completo,Cliente:a.cliente_nombre,"DNI/CUIT":a.cliente_dni,"Neto Gravado 21%":a.neto_gravado_21,"IVA 21%":a.iva_21,"Neto Gravado 10.5%":a.neto_gravado_10_5,"IVA 10.5%":a.iva_10_5,"Neto Gravado 27%":a.neto_gravado_27,"IVA 27%":a.iva_27,"Neto Gravado 5%":a.neto_gravado_5,"IVA 5%":a.iva_5,"Neto Gravado 2.5%":a.neto_gravado_2_5,"IVA 2.5%":a.iva_2_5,Exento:a.exento,"No Gravado":a.no_gravado,Total:a.total,CAE:a.cae}));n.push({Fecha:"","Tipo Comprobante":"","N° Comprobante":"",Cliente:"","DNI/CUIT":"TOTALES","Neto Gravado 21%":this.datos.totales.total_neto_21,"IVA 21%":this.datos.totales.total_iva_21,"Neto Gravado 10.5%":this.datos.totales.total_neto_10_5,"IVA 10.5%":this.datos.totales.total_iva_10_5,"Neto Gravado 27%":this.datos.totales.total_neto_27,"IVA 27%":this.datos.totales.total_iva_27,"Neto Gravado 5%":this.datos.totales.total_neto_5,"IVA 5%":this.datos.totales.total_iva_5,"Neto Gravado 2.5%":this.datos.totales.total_neto_2_5,"IVA 2.5%":this.datos.totales.total_iva_2_5,Exento:this.datos.totales.total_exento,"No Gravado":this.datos.totales.total_no_gravado,Total:this.datos.totales.total_general,CAE:""});const l=I.json_to_sheet(n),v=I.book_new();I.book_append_sheet(v,l,"Libro IVA Ventas");const V=`libro_iva_ventas_${this.fechaDesde}_${this.fechaHasta}.xlsx`;S(v,V)},formatear(n){return L.format(n)},formatearFecha(n){if(!n)return"";const[l,v,V]=n.split("-");return`${V}/${v}/${l}`}},mounted(){this.usuario.rol!=1&&this.$router.push("/no-autorizado");const n=new Date,l=new Date(n.getFullYear(),n.getMonth(),1),v=new Date(n.getFullYear(),n.getMonth()+1,0);this.fechaDesde=l.toISOString().split("T")[0],this.fechaHasta=v.toISOString().split("T")[0]},setup(){return{usuario:k()}}},U={class:"d-flex justify-space-between flex-wrap"};function z(n,l,v,V,a,s){return c(),h(w,{fluid:""},{default:t(()=>[e(m,null,{default:t(()=>[e(u,{cols:"12"},{default:t(()=>[e(x,null,{default:t(()=>[e(A,{class:"d-flex align-center"},{default:t(()=>[e(p,{class:"mr-2"},{default:t(()=>[...l[2]||(l[2]=[o("mdi-file-document-outline",-1)])]),_:1}),l[3]||(l[3]=o(" Libro IVA Ventas ",-1))]),_:1}),e(y,null,{default:t(()=>[e(m,null,{default:t(()=>[e(u,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:a.fechaDesde,"onUpdate:modelValue":l[0]||(l[0]=d=>a.fechaDesde=d),label:"Fecha desde",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:a.fechaHasta,"onUpdate:modelValue":l[1]||(l[1]=d=>a.fechaHasta=d),label:"Fecha hasta",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"4",class:"d-flex align-center"},{default:t(()=>[e(C,{color:"primary",onClick:s.consultarLibroIva,loading:a.loading,class:"mr-2"},{default:t(()=>[e(p,{left:""},{default:t(()=>[...l[4]||(l[4]=[o("mdi-magnify",-1)])]),_:1}),l[5]||(l[5]=o(" Consultar ",-1))]),_:1},8,["onClick","loading"]),e(C,{color:"success",onClick:s.exportarExcel,disabled:!a.datos||a.loading,variant:"outlined"},{default:t(()=>[e(p,{left:""},{default:t(()=>[...l[6]||(l[6]=[o("mdi-microsoft-excel",-1)])]),_:1}),l[7]||(l[7]=o(" Exportar ",-1))]),_:1},8,["onClick","disabled"])]),_:1})]),_:1}),a.datos&&a.datos.totales?(c(),h(m,{key:0,class:"mt-4"},{default:t(()=>[e(u,{cols:"12"},{default:t(()=>[e(D,{type:"info",variant:"tonal"},{default:t(()=>[i("div",U,[i("div",null,[l[8]||(l[8]=i("strong",null,"Período:",-1)),o(" "+r(s.formatearFecha(a.datos.periodo.desde))+" al "+r(s.formatearFecha(a.datos.periodo.hasta)),1)]),i("div",null,[l[9]||(l[9]=i("strong",null,"Comprobantes:",-1)),o(" "+r(a.datos.cantidad_comprobantes),1)]),i("div",null,[l[10]||(l[10]=i("strong",null,"Total General:",-1)),o(" "+r(s.formatear(a.datos.totales.total_general)),1)])])]),_:1})]),_:1})]),_:1})):g("",!0),a.datos&&a.datos.comprobantes?(c(),h(m,{key:1},{default:t(()=>[e(u,{cols:"12"},{default:t(()=>[e(F,{headers:a.headers,items:a.datos.comprobantes,loading:a.loading,class:"elevation-1","items-per-page":"50","items-per-page-options":[10,25,50,100]},{"item.fecha":t(({item:d})=>[o(r(s.formatearFecha(d.fecha)),1)]),"item.numero_completo":t(({item:d})=>[o(r(d.numero_completo),1)]),"item.neto_gravado_21":t(({item:d})=>[o(r(s.formatear(d.neto_gravado_21)),1)]),"item.iva_21":t(({item:d})=>[o(r(s.formatear(d.iva_21)),1)]),"item.neto_gravado_10_5":t(({item:d})=>[o(r(s.formatear(d.neto_gravado_10_5)),1)]),"item.iva_10_5":t(({item:d})=>[o(r(s.formatear(d.iva_10_5)),1)]),"item.total":t(({item:d})=>[i("strong",null,r(s.formatear(d.total)),1)]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})):g("",!0),a.datos&&a.datos.totales?(c(),h(m,{key:2,class:"mt-4"},{default:t(()=>[e(u,{cols:"12"},{default:t(()=>[e(x,{color:"blue-grey-lighten-5"},{default:t(()=>[e(A,null,{default:t(()=>[...l[11]||(l[11]=[o("Totales por Alícuota",-1)])]),_:1}),e(y,null,{default:t(()=>[e(m,{dense:""},{default:t(()=>[e(u,{cols:"12",md:"6"},{default:t(()=>[e(b,{density:"compact"},{default:t(()=>[e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[...l[12]||(l[12]=[i("strong",null,"IVA 21%",-1)])]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[o("Neto: "+r(s.formatear(a.datos.totales.total_neto_21)),1)]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[o("IVA: "+r(s.formatear(a.datos.totales.total_iva_21)),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[e(b,{density:"compact"},{default:t(()=>[e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[...l[13]||(l[13]=[i("strong",null,"IVA 10.5%",-1)])]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[o("Neto: "+r(s.formatear(a.datos.totales.total_neto_10_5)),1)]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[o("IVA: "+r(s.formatear(a.datos.totales.total_iva_10_5)),1)]),_:1})]),_:1})]),_:1})]),_:1}),a.datos.totales.total_neto_27>0?(c(),h(u,{key:0,cols:"12",md:"6"},{default:t(()=>[e(b,{density:"compact"},{default:t(()=>[e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[...l[14]||(l[14]=[i("strong",null,"IVA 27%",-1)])]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[o("Neto: "+r(s.formatear(a.datos.totales.total_neto_27)),1)]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[o("IVA: "+r(s.formatear(a.datos.totales.total_iva_27)),1)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),a.datos.totales.total_exento>0?(c(),h(u,{key:1,cols:"12",md:"6"},{default:t(()=>[e(b,{density:"compact"},{default:t(()=>[e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[...l[15]||(l[15]=[i("strong",null,"Exento",-1)])]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[o("Total: "+r(s.formatear(a.datos.totales.total_exento)),1)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1}),e(G,{class:"my-3"}),e(m,null,{default:t(()=>[e(u,{cols:"12",class:"text-right"},{default:t(()=>[i("h3",null,"Total General: "+r(s.formatear(a.datos.totales.total_general)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),!a.datos&&!a.loading?(c(),h(m,{key:3},{default:t(()=>[e(u,{cols:"12",class:"text-center"},{default:t(()=>[e(D,{type:"info",variant:"outlined"},{default:t(()=>[...l[16]||(l[16]=[o(' Selecciona un período y presiona "Consultar" para ver el libro IVA de ventas ',-1)])]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const R=T(H,[["render",z],["__scopeId","data-v-57cd9163"]]);export{R as default};
