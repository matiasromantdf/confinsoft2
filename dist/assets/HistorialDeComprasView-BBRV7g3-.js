import{aa as w,ab as h,ac as v,ad as t,an as N,af as T,ag as S,h as a,ak as p,al as d,ae as m,am as D,l as r,aj as c,ao as F,aq as b,z as _,ai as n,v as x,az as u,at as k,aK as A,aL as I,aM as M,aN as L,m as y,aO as P,as as z,au as B}from"./index-Cx9PWlU5.js";import{u as V,w as E}from"./xlsx-5_gWIQju.js";const H={data(){return{cargando:!1,compras:[],cabeceras:[{title:"ID",value:"id"},{title:"Fecha",value:"fecha"},{title:"Proveedor",key:"proveedor",value:l=>l.proveedor.nombre},{title:"Monto",value:"monto"},{title:"Acciones",value:"acciones",sortable:!1}],url:"https://api-tpv.confinsoft.com/public",dialogoDetalle:!1,itemsDelDetalle:[],desde:"",hasta:""}},computed:{totalCompras(){return this.compras.reduce((l,e)=>l+parseFloat(e.monto||0),0)},cantidadFiscales(){return this.compras.filter(l=>l.es_compra_fiscal==1).length},cantidadNoFiscales(){return this.compras.filter(l=>l.es_compra_fiscal!=1).length}},methods:{getCompras(){this.cargando=!0;let l=this.url+"/"+this.usuario.tpv+"/compras/filtradas";S.get(l,{params:{desde:this.desde,hasta:this.hasta,param:"historial"},headers:{Authorization:this.usuario.token}}).then(e=>{this.compras=e.data,this.cargando=!1}).catch(e=>{console.error(e),this.cargando=!1})},mostrarDetalle(l){this.itemsDelDetalle=l.detalles,this.itemsDelDetalle.forEach(e=>{delete e.updated_at,delete e.created_at,delete e.compra_id,delete e.articulo_id,delete e.tpv,delete e.id,e.item=e.articulo.descripcion,delete e.articulo}),this.dialogoDetalle=!0},eliminar(l){console.log("eliminar",l)},reimprimir(l){console.log("reimprimir",l)},formatearMonto(l){return l?"$ "+parseFloat(l).toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}):"$ 0,00"},formatearFecha(l){return l?new Date(l).toLocaleDateString("es-AR",{year:"numeric",month:"2-digit",day:"2-digit"}):""},exportarExcel(){if(this.compras.length===0)return;const l=this.compras.map(s=>({ID:s.id,Fecha:this.formatearFecha(s.fecha),Proveedor:s.proveedor.nombre,Monto:parseFloat(s.monto||0),Fiscal:s.es_compra_fiscal==1?"Sí":"No","Tipo Comprobante":s.tipo_comprobante||"N/A","Punto Venta":s.punto_venta||"N/A",Número:s.numero_comprobante||"N/A"})),e=this.compras.reduce((s,i)=>s+parseFloat(i.monto||0),0);l.push({ID:"",Fecha:"",Proveedor:"TOTAL",Monto:e,Fiscal:"","Tipo Comprobante":"","Punto Venta":"",Número:""});const C=V.json_to_sheet(l),g=V.book_new();V.book_append_sheet(g,C,"Historial Compras"),E(g,`Historial_Compras_${this.desde}_${this.hasta}.xlsx`)}},mounted(){this.usuario.rol!=1&&this.$router.push({name:"no-autorizado"}),this.desde=new Date().toISOString().substr(0,10),this.hasta=new Date().toISOString().substr(0,10)},setup(){return{usuario:T()}}},O={class:"text-h6 font-weight-medium"},R={class:"text-h6 font-weight-medium"},U={class:"text-h6 font-weight-medium"},j={class:"text-h6 font-weight-medium"},q={class:"d-flex align-center"};function K(l,e,C,g,s,i){return v(),h(N,null,{default:t(()=>[a(p,null,{default:t(()=>[a(d,null,{default:t(()=>[a(m,null,{default:t(()=>[a(D,null,{default:t(()=>[...e[5]||(e[5]=[r("h3",null,"Historial de Compras",-1)])]),_:1}),a(c,null,{default:t(()=>[a(p,{class:"mt-1"},{default:t(()=>[a(d,{cols:"12",md:"4"},{default:t(()=>[a(b,{label:"desde",modelValue:s.desde,"onUpdate:modelValue":e[0]||(e[0]=o=>s.desde=o),type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"4"},{default:t(()=>[a(b,{label:"hasta",modelValue:s.hasta,"onUpdate:modelValue":e[1]||(e[1]=o=>s.hasta=o),type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"4",class:"text-center"},{default:t(()=>[a(_,{loading:s.cargando,color:"primary",onClick:e[2]||(e[2]=o=>i.getCompras()),class:"mr-2"},{default:t(()=>[...e[6]||(e[6]=[n("Buscar",-1)])]),_:1},8,["loading"]),a(_,{color:"success",onClick:i.exportarExcel,disabled:s.compras.length===0,variant:"outlined"},{default:t(()=>[a(x,{left:""},{default:t(()=>[...e[7]||(e[7]=[n("mdi-microsoft-excel",-1)])]),_:1}),e[8]||(e[8]=n(" Exportar ",-1))]),_:1},8,["onClick","disabled"])]),_:1})]),_:1}),s.compras.length>0?(v(),h(p,{key:0,class:"mt-2"},{default:t(()=>[a(d,{cols:"12",md:"3"},{default:t(()=>[a(m,{variant:"outlined"},{default:t(()=>[a(c,{class:"py-2"},{default:t(()=>[e[9]||(e[9]=r("div",{class:"text-caption text-grey-darken-1"},"Total Compras",-1)),r("div",O,u(i.formatearMonto(i.totalCompras)),1)]),_:1})]),_:1})]),_:1}),a(d,{cols:"12",md:"3"},{default:t(()=>[a(m,{variant:"outlined"},{default:t(()=>[a(c,{class:"py-2"},{default:t(()=>[e[10]||(e[10]=r("div",{class:"text-caption text-grey-darken-1"},"Compras Fiscales",-1)),r("div",R,u(i.cantidadFiscales),1)]),_:1})]),_:1})]),_:1}),a(d,{cols:"12",md:"3"},{default:t(()=>[a(m,{variant:"outlined"},{default:t(()=>[a(c,{class:"py-2"},{default:t(()=>[e[11]||(e[11]=r("div",{class:"text-caption text-grey-darken-1"},"Compras No Fiscales",-1)),r("div",U,u(i.cantidadNoFiscales),1)]),_:1})]),_:1})]),_:1}),a(d,{cols:"12",md:"3"},{default:t(()=>[a(m,{variant:"outlined"},{default:t(()=>[a(c,{class:"py-2"},{default:t(()=>[e[12]||(e[12]=r("div",{class:"text-caption text-grey-darken-1"},"Total Registros",-1)),r("div",j,u(s.compras.length),1)]),_:1})]),_:1})]),_:1})]),_:1})):F("",!0),a(p,null,{default:t(()=>[a(d,null,{default:t(()=>[a(k,{items:s.compras,headers:s.cabeceras,"no-data-text":"sin datos","items-per-page-text":"filas"},{"item.id":t(({item:o})=>[r("div",q,[r("span",null,u(o.id),1),o.es_compra_fiscal==1?(v(),h(P,{key:0,location:"top"},{activator:t(({props:f})=>[a(x,y(f,{color:"success",size:"small",class:"ml-2"}),{default:t(()=>[...e[13]||(e[13]=[n(" mdi-file-document-check ",-1)])]),_:1},16)]),default:t(()=>[e[14]||(e[14]=r("span",null,"Compra Fiscal",-1))]),_:1})):F("",!0)])]),"item.monto":t(({item:o})=>[n(u(i.formatearMonto(o.monto)),1)]),"item.fecha":t(({item:o})=>[n(u(i.formatearFecha(o.fecha)),1)]),"item.acciones":t(({item:o})=>[a(A,null,{activator:t(({props:f})=>[a(_,y({variant:"flat"},f),{default:t(()=>[a(x,null,{default:t(()=>[...e[15]||(e[15]=[n("mdi-dots-vertical",-1)])]),_:1})]),_:1},16)]),default:t(()=>[a(I,null,{default:t(()=>[a(M,{onClick:f=>i.mostrarDetalle(o)},{default:t(()=>[a(L,null,{default:t(()=>[...e[16]||(e[16]=[n("Ver detalle",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["items","headers"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(z,{modelValue:s.dialogoDetalle,"onUpdate:modelValue":e[4]||(e[4]=o=>s.dialogoDetalle=o),"max-width":"90%"},{default:t(()=>[a(m,null,{default:t(()=>[a(D,null,{default:t(()=>[...e[17]||(e[17]=[r("h3",null,"Detalle de la compra",-1)])]),_:1}),a(c,null,{default:t(()=>[a(p,null,{default:t(()=>[a(d,null,{default:t(()=>[a(k,{items:s.itemsDelDetalle,"items-per-page-text":"Filas"},null,8,["items"])]),_:1})]),_:1})]),_:1}),a(B,null,{default:t(()=>[a(_,{onClick:e[3]||(e[3]=o=>s.dialogoDetalle=!1)},{default:t(()=>[...e[18]||(e[18]=[n("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Q=w(H,[["render",K]]);export{Q as default};
