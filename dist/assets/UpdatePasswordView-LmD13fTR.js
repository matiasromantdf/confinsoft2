import{_ as c,Y as d,Z as i,$ as r,a8 as f,a2 as w,b as o,a6 as h,a7 as V,a0 as j,ad as k,h as y,a5 as g,aj as P,ao as b,av as u,a4 as l,V as p,ar as v,as as C,aa as m,al as M}from"./index-xcw0-fmd.js";const q={data(){return{token:"",newPassword:"",confirmPassword:"",loading:!1,mensaje:"",tipoMensaje:"success",tokenValido:!0,url:"https://api-tpv.confinsoft.com/public"}},mounted(){this.token=this.$route.query.token||this.$route.params.token,this.token||(this.tokenValido=!1,this.mensaje="No se proporcionó un token válido.",this.tipoMensaje="error")},methods:{required(e){return!!e||"El campo es requerido"},minLength(e){return e&&e.length>=6||"La contraseña debe tener al menos 6 caracteres"},passwordsMatch(e){return e===this.newPassword||"Las contraseñas no coinciden"},async updatePassword(){if(this.newPassword!==this.confirmPassword){this.mensaje="Las contraseñas no coinciden",this.tipoMensaje="error";return}this.loading=!0,this.mensaje="";try{const e=new FormData;e.append("token",this.token),e.append("password",this.newPassword),e.append("password_confirmation",this.confirmPassword),(await w.post(this.url+"/update-password",e,{timeout:15e3})).status===200&&(this.mensaje="Contraseña actualizada correctamente. Será redirigido al login.",this.tipoMensaje="success",setTimeout(()=>{this.$router.push("/login")},3e3))}catch(e){console.error("Error al actualizar contraseña:",e),e.response&&e.response.status===400?(this.mensaje="El token no es válido o ha expirado.",this.tipoMensaje="error",this.tokenValido=!1):e.response&&e.response.status===422?(this.mensaje="Error de validación. Verifique que las contraseñas cumplan los requisitos.",this.tipoMensaje="error"):e.response&&e.response.data&&e.response.data.message?(this.mensaje=e.response.data.message,this.tipoMensaje="error"):(this.mensaje="Error al actualizar la contraseña. Intente nuevamente.",this.tipoMensaje="error")}finally{this.loading=!1}}}},x={key:0,class:"text-center"};function _(e,s,E,N,a,t){return i(),d(f,null,{default:r(()=>[o(h,{justify:"center"},{default:r(()=>[o(V,{md:"6",sm:"12"},{default:r(()=>[o(j,{class:"pa-6"},{default:r(()=>[o(k,null,{default:r(()=>[...s[3]||(s[3]=[y("h3",null,"Actualizar Contraseña",-1)])]),_:1}),o(g,null,{default:r(()=>[a.tokenValido?(i(),d(v,{key:1,onSubmit:C(t.updatePassword,["prevent"])},{default:r(()=>[o(m,{modelValue:a.newPassword,"onUpdate:modelValue":s[1]||(s[1]=n=>a.newPassword=n),label:"Nueva Contraseña",type:"password",rules:[t.required,t.minLength],readonly:a.loading,variant:"outlined",class:"mb-3",required:""},null,8,["modelValue","rules","readonly"]),o(m,{modelValue:a.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=n=>a.confirmPassword=n),label:"Confirmar Nueva Contraseña",type:"password",rules:[t.required,t.passwordsMatch],readonly:a.loading,variant:"outlined",class:"mb-4",required:""},null,8,["modelValue","rules","readonly"]),o(p,{color:"primary",block:"",type:"submit",loading:a.loading,disabled:!a.newPassword||!a.confirmPassword||a.loading},{default:r(()=>[...s[6]||(s[6]=[l(" Actualizar Contraseña ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["onSubmit"])):(i(),P("div",x,[o(u,{type:"error",class:"mb-4"},{default:r(()=>[...s[4]||(s[4]=[l(" El enlace de recuperación no es válido o ha expirado. ",-1)])]),_:1}),o(p,{color:"primary",onClick:s[0]||(s[0]=n=>e.$router.push("/login"))},{default:r(()=>[...s[5]||(s[5]=[l(" Volver al Login ",-1)])]),_:1})])),a.mensaje?(i(),d(u,{key:2,type:a.tipoMensaje,class:"mt-4"},{default:r(()=>[l(M(a.mensaje),1)]),_:1},8,["type"])):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const z=c(q,[["render",_]]);export{z as default};
